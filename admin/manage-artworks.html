<!-- admin/manage-artworks.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Artworks</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <h1 class="text-3xl font-bold text-center mt-4 mb-8">Manage Artworks</h1>

    <table class="min-w-full table-auto border-collapse border border-gray-300">
        <thead>
            <tr class="bg-gray-100">
                <th class="border px-4 py-2">Title</th>
                <th class="border px-4 py-2">Description</th>
                <th class="border px-4 py-2">Tags</th>
                <th class="border px-4 py-2">Image</th>
                <th class="border px-4 py-2">Actions</th>
            </tr>
        </thead>
        <tbody id="artworks-table" class="text-center">
            <!-- Artwork rows will be inserted dynamically -->
        </tbody>
    </table>
<!-- Modal for editing artwork -->
    <div id="edit-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="bg-white p-6 rounded shadow-md w-96">
            <h2 class="text-xl font-bold mb-4">Edit Artwork</h2>
            <form id="edit-form">
                <input type="hidden" id="edit-id">
                <label class="block mb-2 font-medium">Title</label>
                <input type="text" id="edit-title" class="w-full border p-2 mb-4">

                <label class="block mb-2 font-medium">Description</label>
                <textarea id="edit-description" class="w-full border p-2 mb-4"></textarea>

                <label class="block mb-2 font-medium">Tags (comma separated)</label>
                <input type="text" id="edit-tags" class="w-full border p-2 mb-4">

                <div class="flex justify-end space-x-2">
                    <button type="button" onclick="closeModal()" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
                    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Save</button>
                </div>
            </form>
        </div>
    </div>
    <script>
        // Fetch and display artworks from the server
        fetch('/artworks')
            .then(response => response.json())
            .then(artworks => {
                const tableBody = document.getElementById('artworks-table');
                artworks.forEach(artwork => {
                    const row = document.createElement('tr');
                    row.classList.add('border-b');
                    row.innerHTML = `
                        <td class="border px-4 py-2">${artwork.title}</td>
                        <td class="border px-4 py-2">${artwork.description}</td>
                        <td class="border px-4 py-2">${artwork.tags.join(', ')}</td>
                        <td class="border px-4 py-2"><img src="${artwork.image}" alt="${artwork.title}" width="100"></td>
                        <td class="border px-4 py-2">
                            <button onclick="editArtwork('${artwork._id}')" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600">Edit</button>
                            <button onclick="deleteArtwork('${artwork._id}')" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">Delete</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            })
            .catch(err => console.error('Error fetching artworks:', err));

        
        // Function to delete artwork
    function deleteArtwork(id) {
        fetch(`/admin/delete-artwork/${id}`, {  // Use backticks for template literal
            method: 'DELETE'
        })
        .then(response => {
            if (response.ok) {
                alert('Artwork deleted!');
                window.location.reload();  // Reload the page to update the table
            } else {
                alert('Error deleting artwork');
            }
        })
        .catch(err => console.error('Error deleting artwork:', err));
    }


    // Open modal and populate with data
function editArtwork(id) {
    fetch(`/artworks/${id}`)
        .then(response => response.json())
        .then(artwork => {
            document.getElementById('edit-id').value = artwork._id;
            document.getElementById('edit-title').value = artwork.title;
            document.getElementById('edit-description').value = artwork.description;
            document.getElementById('edit-tags').value = artwork.tags.join(', ');

            document.getElementById('edit-modal').classList.remove('hidden');
        })
        .catch(err => console.error('Error loading artwork:', err));
}

// Close the modal
function closeModal() {
    document.getElementById('edit-modal').classList.add('hidden');
}

// Submit edited data
document.getElementById('edit-form').addEventListener('submit', function (e) {
    e.preventDefault();

    const id = document.getElementById('edit-id').value;
    const title = document.getElementById('edit-title').value;
    const description = document.getElementById('edit-description').value;
    const tags = document.getElementById('edit-tags').value.split(',').map(tag => tag.trim());

    fetch(`/admin/update-artwork/${id}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ title, description, tags }),
    })
        .then(response => {
            if (response.ok) {
                alert('Artwork updated!');
                closeModal();
                window.location.reload();
            } else {
                alert('Failed to update artwork.');
            }
        })
        .catch(err => console.error('Error updating artwork:', err));
});

    </script>
</body>
</html>
